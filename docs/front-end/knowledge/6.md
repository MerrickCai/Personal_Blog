---
layout: docs
title: Pinia
description: Pinia
---

# Pinia

[https://pinia.vuejs.org/](https://pinia.vuejs.org/)

## 概述

**Pinia 是 Vue 的状态管理工具，有助于组件之间通信和数据的全局响应式**

## Pinia数据文件
```javascript
//相对路径：/PiniaStores/index.js
import { defineStore } from 'pinia'
//导出 useStore 函数
export const useStore = defineStore('main', { //第一个参数是开发要用的id，可忽略
  state: () => ({
    //state函数返回一个对象，对象内是响应式数据
    name: 'cai',
    value: 5
  }),
  getters: {
    //计算属性
    doubleValue: (state) => state.value * 2, //state指代当前的数据库,箭头函数this不准确
    doublePlusOne() { //如果不传参就用this指代当前的数据库
      return this.value * 2 + 1
      //return this.doubleValue * 2 + 1    //计算属性套娃
    },
  },
  actions: {
    //方法
    increment() {
      this.value++
    },
    decline() {
      this.value--
    },
    async registerUser(login, password) { //方法支持异步函数
      try {
        this.userData = await api.post({ login, password })
        show(`Welcome back ${this.userData.name}!`)
      } catch (error) {
        show(error)
      }
    }
  }
})
```
## 在任意组件中使用
```javascript
<script setup>
import { useStore } from '/PiniaStores/index.js' //相对路径
const datas = useStore()
//使用属性直接访问
datas.value++
//使用方法
datas.increment()
//$patch方法，传入对象
datas.$patch({ value: datas.value + 1 })
//$patch方法，传入函数（处理集合突变：为数组push新的值时，不用创建一个新的数组）
//传入对象做法处理集合突变(解构赋值)
//datas.$patch({
//  datas.arr=[...datas.arr,{ name: 'shoes', quantity: 1 }]
//})
datas.$patch((state) => {
  state.arr.push({ name: 'shoes', quantity: 1 })
})
//重置datas（数据回到一开始定义的值）
datas.$reset()
</script>
```

## 进阶用法 订阅
```javascript
datas.$subscribe((mutation, state) => {
  // import { MutationType } from 'pinia'
  mutation.type // 'direct' | 'patch object' | 'patch function'
  // same as datas.$id
  mutation.storeId // 'main'
  // only available with mutation.type === 'patch object'
  mutation.payload // patch object passed to datas.$patch()
  // 每当它发生变化时，将整个状态持久化到本地存储
  localStorage.setItem('cart', JSON.stringify(state))
},{ detached: true })//卸载组件后保留订阅
```
